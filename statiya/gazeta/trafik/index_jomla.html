<html>

<head>
  <title></title>
</head>

<body>

<p><strong>Исходный данные: </strong></p>
<table border="1">
<tbody>
<tr>
<td><span style="color: green; font-size: small;"><strong>(84.56.32.7)eth1</strong></span></td>
<td><span style="color: green; font-size: small;"><strong>внешний интерфейс</strong></span></td>
</tr>
<tr>
<td><span style="color: green; font-size: small;"><strong>(192.168.50.3)eth0</strong></span></td>
<td><span style="color: green; font-size: small;"><strong>внутренний интерфейс</strong></span></td>
</tr>
</tbody>
</table>
<p><strong>Задача: </strong></p>
<p>Надо посчитать входящий и исходящий по eth1 и   входящий трафик по eth0( порт 3138, 110 и nat)+прикрутить web морду</p>
<p> </p>
<p><strong><span style="color: blue; font-size: small;">Настраиваем ipcad: </span></strong></p>
<div class="codeheader">ipcad.conf</div>
<div class="code">capture-ports enable;<br />buffers = 128k;<br />interface eth1;<br />interface eth0;<br />aggregate 192.168.50.0/24 strip32;<br />rsh enable at 127.0.0.1;<br />rsh root@127.0.0.1 admin;<br />rsh root@127.0.0.1 backup;<br />rsh root@127.0.0.1;<br />rsh 127.0.0.1 view-only;<br />rsh ttl = 3;<br />rsh timeout = 30;<br />dumpfile = /var/log/ipcad/ipcad.dump;<br />pidfile = /var/run/ipcad.pid;<br />memory_limit = 80m;</div>
<p> </p>
<p> </p>
<h3><span style="color: blue; font-size: small;"><strong>Настраиваем mysql </strong></span><strong> </strong></h3>
<p>Создадим базу допуститм spacedust</p>
<div class="codeheader">Создаем базу где будет храниться вся инфа</div>
<div class="code">[root@spacedust ~]# mysql -u root <br />Welcome to the MySQL monitor.  Commands end with ; or \g.<br />Your MySQL connection id is 1000 to server version: 4.1.20<br /><br /><br />Type 'help;' or '\h' for help. Type '\c' to clear the buffer.<br /><br /><br />mysql&gt; create database spacedust;<br />Query OK, 1 row affected (0.03 sec)<br /><br /><br />mysql&gt; show databases;<br />+-----------+<br />| Database  |<br />+-----------+<br />| mysql     |<br />| spacedust |<br />| test      |<br />+-----------+<br />3 rows in set (0.00 sec)<br /><br /><br />mysql&gt;</div>
<p> </p>
<p>Теперь создадим таблицы для внешнего и внутреннего интерфейса</p>
<div class="codeheader">Таблицы eth0,eth1</div>
<div class="code">[root@spacedust ~]# mysql -u root<br />Welcome to the MySQL monitor.  Commands end with ; or \g.<br />Your MySQL connection id is 1001 to server version: 4.1.20<br /><br /><br />Type 'help;' or '\h' for help. Type '\c' to clear the buffer.<br /><br /><br />mysql&gt; use spacedust;<br />Database changed<br />mysql&gt; create table eth1( id int(11) NOT NULL AUTO_increment,date DATE,ip VARCHAR(90) not null,output double(90,4) not null,input double(90,4) not null, primary key(id));<br />Query OK, 0 rows affected (0.06 sec)<br /><br /><br />mysql&gt; create table eth0( id int(11) NOT NULL AUTO_increment,date DATE,ip VARCHAR(90) not null,sendmail double(90,2) not null,squid double(90,2) not null,nat double(90,2) not null, primary key(id));<br />Query OK, 0 rows affected (0.02 sec)<br /><br /><br />mysql&gt; show tables;<br />+---------------------+<br />| Tables_in_spacedust |<br />+---------------------+<br />| eth0                |<br />| eth1                <br />+---------------------+<br />2 rows in set (0.02 sec)<br /><br /><br />mysql&gt;</div>
<p> </p>
<p> </p>
<h3><span style="color: blue; font-size: small;"><strong>Прикручиваем web - морду </strong></span><strong> </strong></h3>
<p>Создаем в каталоге /var/www/html папку traf_inza в нее еще папку index</p>
<p>Считаем входящий и исходящий по eth1 при этом обрезаем под сеть провайдера     в силу того что она бесплатная, у меня она такая(84.56.).Создаем скрипт      traf_eth1 со следующим содержанием:</p>
<div class="codeheader">/var/www/html/traf_inza/traf_eth1;  eth1 - фаил с моими внешними ip</div>
<div class="code">for i in $(cat /var/www/html/traf_inza/eth1); do<br /> echo $i<br />/usr/bin/rsh localhost show ip accounting | grep -w $i |awk '{{if($2!~/84.56./ &amp;&amp; $2!~/192.168./ &amp;&amp;  $8=="eth1"){s+=$4}} {if($1!~/84.56./ &amp;&amp; $1!~/192.168./ &amp;&amp;  $8=="eth1"){s1+=$4}}}  END {printf "%9.4f\n %9.4f\n ",((s/1024)/1024),((s1/1024)/1024)}'<br />done</div>
<p> </p>
<p>Считаем входящий по eth0 (порты 110,3128,nat) при этом обрезаем весь     весь не нужный сетевой трафик, а так же трафик провайдера. Создаем скрипт traf_eth0 со следующим содержанием:</p>
<div class="codeheader">/var/www/html/traf_inza/traf_eth0;  eth0 - фаил с моими локальными ip</div>
<div class="code">for i in $(cat /var/www/html/traf_inza/eth0); do <br /> echo $i<br />/usr/bin/rsh localhost show ip accounting | grep -w $i |awk '{{if($1=="192.168.50.3" &amp;&amp; $8=="eth0" &amp;&amp; $5=="110"){s+=$4}} {if($1=="192.168.50.3" &amp;&amp; $8=="eth0" &amp;&amp; $5=="3128"){s1+=$4}}  {if($1!~/192.168./ &amp;&amp; $8=="eth0" &amp;&amp; $2!~/(192.168.50.[3|255])$)/ &amp;&amp; $1!~/84.56./){s2+=$4}}}  END {printf "%9.4f\n %9.4f\n %9.4f\n ",((s/1024)/1024),((s1/1024)/1024),((s2/1024)/1024)}'<br />done</div>
<p> </p>
<p>Поесню немного что значят эти порты</p>
<ul>
<li><strong>110</strong> - трафик почтовый(это имеет смысл делать, если есть свой почтовый сервер),             <br /> но тут есть своя погрешность будет считать и локальный трафик почты</li>
<li> </li>
<li><strong>nat</strong> - весь транкзитный трафик который идет через мой router (трафик FORWARD) </li>
<li><strong>3128</strong> - у меня на этом порту крутиться прокси сервер</li>
</ul>
<p> </p>
<p><span style="color: green;">index_eth0.php - просмотр в реальном времени интерфейса eth0</span></p>
<div class="codeheader">/var/www/html/traf_inza/index/index_eth0.php</div>
<div class="code">&lt;?php<br />exec("/var/www/html/traf_inza/traf_eth0",$traf_inza);<br />set_time_limit(330);<br />$j=0;<br />$sum1=0;<br />$sum2=0;<br />$sum3=0;<br /><br /><br />echo "&lt;table border=1&gt;\n";<br />echo "&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;IP&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /><br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;SENDMAIL[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /><br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;SQUID[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /><br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;NAT[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;\n";<br /><br /><br /><br />for($i=0;$i&lt;(count($traf_inza)/4)-1;$i++)<br />{<br /> if($traf_inza[$i+$j+1]&gt;9)<br /> {$color1=red;} else {$color1=black;}<br /> if($traf_inza[$i+$j+2]&gt;9)<br /> {$color2=red;} else {$color2=black;}<br /> if($traf_inza[$i+$j+3]&gt;9)<br /> {$color3=red;} else {$color3=black;}<br /> $sum1+=$traf_inza[$i+$j+1];<br /> $sum2+=$traf_inza[$i+$j+2];<br /> $sum3+=$traf_inza[$i+$j+3];<br /> printf("&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=blue&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/front&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=$color1&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=$color2&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=$color3&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;\n",<br /> $traf_inza[$i+$j],$traf_inza[$i+$j+1],$traf_inza[$i+$j+2],$traf_inza[$i+$j+3]);<br /> $j+=3;<br /><br /><br />}<br /> printf("&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=blue&gt;&lt;b&gt;SPACEDUST.RU&lt;/b&gt;&lt;/front&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/tr&gt;\n",$sum1,$sum2,$sum3);<br />echo "&lt;/table&gt;\n";<br />?&gt;</div>
<p> </p>
<p><span style="color: green;">index_eth1.php - просмотр в реальном времени интерфейса eth1</span></p>
<div class="codeheader">/var/www/html/traf_inza/index/index_eth1.php</div>
<div class="code">&lt;?php<br />exec("/var/www/html/traf_inza/traf_eth1",$traf_inza);<br />set_time_limit(330);<br />$j=0;<br />$sum1=0;<br />$sum2=0;<br /><br /><br />echo "&lt;table border=1&gt;\n";<br />echo "&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;IP&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;OUTPUT[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;INPUT[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;\n";<br /><br /><br />for($i=0;$i&lt;(count($traf_inza)/3)-1;$i++)<br />{<br /> if($traf_inza[$i+$j+1]&gt;280)<br /> {$color1=red;} else {$color1=black;}<br /> if($traf_inza[$i+$j+2]&gt;280)<br /> {$color2=red;} else {$color2=black;}<br /> $sum1+=$traf_inza[$i+$j+1];<br /> $sum2+=$traf_inza[$i+$j+2];<br /> printf("&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=blue&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/front&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=$color1&gt;&lt;b&gt;%9.4f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=$color2&gt;&lt;b&gt;%9.4f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/tr&gt;\n",$traf_inza[$i+$j],$traf_inza[$i+$j+1],$traf_inza[$i+$j+2]);<br /> $j+=2;<br /><br /><br />}<br /> printf("&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=blue&gt;&lt;b&gt;SPACEDUST.RU&lt;/b&gt;&lt;/front&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.4f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.4f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/tr&gt;\n",$sum1,$sum2);<br />echo "&lt;/table&gt;\n";<br />?&gt;</div>
<p> </p>
<p><span style="color: green;">index_mysql.php - это скрипт который будет запускаться каждый день и сбрасывать статистику в базу spacedust(mysql) и обнуляет ее, время задает в cron, рекомендую поставить время 23:50</span></p>
<div class="codeheader">/var/www/html/traf_inza/index/index_mysql.php</div>
<div class="code">&lt;?php<br />exec("/var/www/html/traf_inza/traf_eth0",$traf_inza);<br />exec("/var/www/html/traf_inza/traf_eth1",$traf_inza1);<br />set_time_limit(330);<br />$j=0;<br />$sum1=0;<br />$sum2=0;<br />$sum3=0;<br /><br /><br />$day=date('d');<br />$month=date('m');<br />$year=date('y'); <br />$date="20".$year."-".$month."-".$day;<br /><br /><br />$link = mysql_connect("localhost", "root", "") or die("no connect"); <br />mysql_select_db("spacedust", $link) or die("no vibor");<br /><br /><br />for($i=0;$i&lt;(count($traf_inza)/4)-1;$i++)<br />{<br />$traf_ip=trim($traf_inza[$i+$j]);<br />$traf_mail=trim($traf_inza[$i+$j+1]);<br />$traf_squid=trim($traf_inza[$i+$j+2]);<br />$traf_nat=trim($traf_inza[$i+$j+3]);<br />$sum1+=$traf_inza[$i+$j+1];<br />$sum2+=$traf_inza[$i+$j+2];<br />$sum3+=$traf_inza[$i+$j+3];<br /><br /><br />$query="INSERT INTO eth0 (date,ip,sendmail,squid,nat) VALUES ('$date','$traf_ip','$traf_mail','$traf_squid','$traf_nat')";<br />$result = mysql_query($query,$link);<br />$j+=3;<br /><br />}<br />$query="INSERT INTO eth0 (date,ip,sendmail,squid,nat) VALUES ('$date','SPACEDUST','$sum1','$sum2','$sum3')";<br />$result = mysql_query($query,$link);<br /><br /><br />$j=0;<br />$sum1=0;<br />$sum2=0;<br />for($i=0;$i&lt;(count($traf_inza1)/3)-1;$i++)<br />{<br />$traf_ip=trim($traf_inza1[$i+$j]);<br />$traf_out=trim($traf_inza1[$i+$j+1]);<br />$traf_in=trim($traf_inza1[$i+$j+2]);<br />$sum1+=$traf_inza1[$i+$j+1];<br />$sum2+=$traf_inza1[$i+$j+2];<br />$query="INSERT INTO eth1 (date,ip,output,input) VALUES ('$date','$traf_ip','$traf_out','$traf_in')";<br />$result = mysql_query($query,$link);<br />$j+=2;}<br />$query="INSERT INTO eth1 (date,ip,output,input) VALUES ('$date','SPACEDUST','$sum1','$sum2')";<br />$result = mysql_query($query,$link);<br />mysql_close($link);<br />exec("/usr/bin/rsh localhost clear ip accounting");<br />?&gt;<br /><br /><br /></div>
<p> </p>
<p><span style="color: green;">index_mysql2.php - это скрипт который выдирает статистику из базы spacedust(mysql)</span></p>
<div class="codeheader">/var/www/html/traf_inza/index/index_mysql2.php</div>
<div class="code">&lt;?php<br />if(isset($_POST['month_begin']) &amp;&amp; isset($_POST['year_begin']) &amp;&amp; isset($_POST['day_begin']) &amp;&amp; isset($_POST['year_end']) &amp;&amp; isset($_POST['month_end']) &amp;&amp; isset($_POST['day_end']))<br />{<br /> $date_d1=$_POST['day_begin'];<br /> $date_m1=$_POST['month_begin'];<br /> $date_y1=$_POST['year_begin'];<br /> $date_d2=$_POST['day_end'];<br /> $date_m2=$_POST['month_end'];<br /> $date_y2=$_POST['year_end'];<br /> <br /><br /> $date_begin=$date_y1."-".$date_m1."-".$date_d1;<br /> $date_end=$date_y2."-".$date_m2."-".$date_d2;<br /><br /><br />echo "&lt;HTML&gt;&lt;TITLE&gt; ipcad.spacedust.ru $date_begin  -  $date_end &lt;/TITLE&gt;&lt;/HTML&gt;";<br /><br /><br />echo "&lt;table border=1&gt;\n";<br />echo "&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;IP&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;SENDMAIL[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;SQUID[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;NAT[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;\n";<br /><br /><br />$link = mysql_connect("localhost", "root", "") or die("no connect");<br />mysql_select_db("spacedust", $link) or die("no vibor");<br /><br /><br />$ip_array=file("/var/www/html/traf_inza/eth0");<br />for($i=0;$i&lt;count($ip_array);$i++)<br />{<br />$ip=trim($ip_array[$i]);<br />$query="select * from eth0 where ip='$ip' &amp;&amp; date&gt;='$date_begin' &amp;&amp; date&lt;='$date_end';";<br />$result = mysql_query($query,$link);<br />$sum_mail=0;<br />$sum_squid=0;<br />$sum_nat=0;<br /><br /><br />while ($traf=mysql_fetch_row($result))<br /> {<br /> $sum_mail+=$traf[3];<br /> $sum_squid+=$traf[4];<br /> $sum_nat+=$traf[5];<br /> }<br /><br /><br />printf("&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=blue&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/front&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=black&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=black&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=black&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;\n",<br /> $ip,$sum_mail,$sum_squid,$sum_nat);<br /><br /><br />}<br /><br /><br />$query="select * from eth0 where ip='SPACEDUST' &amp;&amp; date&gt;='$date_begin' &amp;&amp; date&lt;='$date_end';";<br />$result = mysql_query($query,$link);<br />$sum_mail=0;<br />$sum_squid=0;<br />$sum_nat=0;<br />while ($traf=mysql_fetch_row($result))<br /> {<br /> $sum_mail+=$traf[3];<br /> $sum_squid+=$traf[4];<br /> $sum_nat+=$traf[5];<br /> }<br />printf("&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=blue&gt;&lt;b&gt;SPACEDUST.RU&lt;/b&gt;&lt;/front&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.2f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;\n",<br /> $sum_mail,$sum_squid,$sum_nat);<br /><br /><br /><br /><br />echo "&lt;/table&gt;";<br /><br /><br />echo "&lt;table border=1&gt;\n";<br />echo "&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;IP&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;OUTPUT[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;<br /> &lt;td&gt;&lt;FONT SIZE=3 COLOR=green&gt;&lt;b&gt;INPUT[MB]&lt;/front&gt;&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;\n";<br /><br /><br />$ip_array=file("/var/www/html/traf_inza/eth1");<br />for($i=0;$i&lt;count($ip_array);$i++)<br />{<br /> $ip=trim($ip_array[$i]);<br /> $query="select * from eth1 where ip='$ip' &amp;&amp; date&gt;='$date_begin' &amp;&amp; date&lt;='$date_end';";<br /> $result = mysql_query($query,$link);<br /> $sum_out=0;<br /> $sum_in=0;<br />while ($traf=mysql_fetch_row($result))<br /> {<br /> $sum_out+=$traf[3];<br /> $sum_in+=$traf[4];<br /> }<br /><br /> <br />printf("&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=blue&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/front&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=black&gt;&lt;b&gt;%9.4f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=black&gt;&lt;b&gt;%9.4f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/tr&gt;\n",$ip,$sum_out,$sum_in);<br /><br /><br />}<br /><br /><br />$query="select * from eth1 where ip='SPACEDUST' &amp;&amp; date&gt;='$date_begin' &amp;&amp; date&lt;='$date_end';";<br />$result = mysql_query($query,$link);<br />$sum_out=0;<br />$sum_in=0;<br />while ($traf=mysql_fetch_row($result))<br /> {<br /> $sum_out+=$traf[3];<br /> $sum_in+=$traf[4];<br /> }<br /><br /><br />printf("&lt;tr&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=blue&gt;&lt;b&gt;SPACEDUST.RU&lt;/b&gt;&lt;/front&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.4f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/td&gt;&lt;td&gt;&lt;FONT SIZE=3 COLOR=red&gt;&lt;b&gt;%9.4f&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br /> &lt;/tr&gt;\n",$sum_out,$sum_in);<br /><br /><br /><br /><br />echo "&lt;/table&gt;";<br />mysql_close($link);<br /><br /><br />}<br />?&gt;</div>
<p> </p>
<p><span style="color: green;">index.php - это наш головной фаил для web морды</span></p>
<div class="codeheader">/var/www/html/traf_inza/index/index.php</div>
<div class="code">&lt;HTML&gt;<br />&lt;TITLE&gt; spacedust.trafice.ipcad.ru&lt;/TITLE&gt;<br />&lt;BODY&gt;<br />&lt;FORM method="POST" action="index_mysql2.php"&gt;<br />&lt;SELECT name="day_begin"&gt;<br /> &lt;OPTION VALUE="01"&gt;01<br /> &lt;OPTION VALUE="02"&gt;02<br /> &lt;OPTION VALUE="03"&gt;03<br /> &lt;OPTION VALUE="04"&gt;04<br /> &lt;OPTION VALUE="05"&gt;05<br /> &lt;OPTION VALUE="06"&gt;06<br /> &lt;OPTION VALUE="07"&gt;07<br /> &lt;OPTION VALUE="08"&gt;08<br /> &lt;OPTION VALUE="09"&gt;09<br /> &lt;OPTION VALUE="10"&gt;10<br /> &lt;OPTION VALUE="11"&gt;11<br /> &lt;OPTION VALUE="12"&gt;12<br /> &lt;OPTION VALUE="13"&gt;13<br /> &lt;OPTION VALUE="14"&gt;14<br /> &lt;OPTION VALUE="15"&gt;15<br /> &lt;OPTION VALUE="16"&gt;16<br /> &lt;OPTION VALUE="17"&gt;17<br /> &lt;OPTION VALUE="18"&gt;18<br /> &lt;OPTION VALUE="19"&gt;19<br /> &lt;OPTION VALUE="20"&gt;20<br /> &lt;OPTION VALUE="21"&gt;21<br /> &lt;OPTION VALUE="22"&gt;22<br /> &lt;OPTION VALUE="23"&gt;23<br /> &lt;OPTION VALUE="24"&gt;24<br /> &lt;OPTION VALUE="25"&gt;25<br /> &lt;OPTION VALUE="26"&gt;26<br /> &lt;OPTION VALUE="27"&gt;27<br /> &lt;OPTION VALUE="28"&gt;28<br /> &lt;OPTION VALUE="29"&gt;29<br /> &lt;OPTION VALUE="30"&gt;30<br /> &lt;OPTION VALUE="31"&gt;31<br />&lt;/SELECT&gt;<br /><br /><br />&lt;SELECT name="month_begin"&gt;<br /> &lt;OPTION VALUE="01"&gt;January<br /> &lt;OPTION VALUE="02"&gt; February<br /> &lt;OPTION VALUE="03"&gt;March<br /> &lt;OPTION VALUE="04"&gt;April<br /> &lt;OPTION VALUE="05"&gt; May<br /> &lt;OPTION VALUE="06"&gt;June<br /> &lt;OPTION VALUE="07"&gt;July<br /> &lt;OPTION VALUE="08"&gt; August<br /> &lt;OPTION VALUE="09 "&gt;September<br /> &lt;OPTION VALUE="10"&gt;October<br /> &lt;OPTION VALUE="11"&gt; November<br /> &lt;OPTION VALUE="12"&gt;December<br />&lt;/SELECT&gt;<br />&lt;SELECT name="year_begin"&gt;<br /> &lt;OPTION VALUE="2008"&gt;2008<br /> &lt;OPTION VALUE="2009"&gt;2009<br /> &lt;OPTION VALUE="2010"&gt;2010<br />&lt;/SELECT&gt;<br />&lt;SELECT name="day_end"&gt;<br /> &lt;OPTION VALUE="01"&gt;01<br /> &lt;OPTION VALUE="02"&gt;02<br /> &lt;OPTION VALUE="03"&gt;03<br /> &lt;OPTION VALUE="04"&gt;04<br /> &lt;OPTION VALUE="05"&gt;05<br /> &lt;OPTION VALUE="06"&gt;06<br /> &lt;OPTION VALUE="07"&gt;07<br /> &lt;OPTION VALUE="08"&gt;08<br /> &lt;OPTION VALUE="09"&gt;09<br /> &lt;OPTION VALUE="10"&gt;10<br /> &lt;OPTION VALUE="11"&gt;11<br /> &lt;OPTION VALUE="12"&gt;12<br /> &lt;OPTION VALUE="13"&gt;13<br /> &lt;OPTION VALUE="14"&gt;14<br /> &lt;OPTION VALUE="15"&gt;15<br /> &lt;OPTION VALUE="16"&gt;16<br /> &lt;OPTION VALUE="17"&gt;17<br /> &lt;OPTION VALUE="18"&gt;18<br /> &lt;OPTION VALUE="19"&gt;19<br /> &lt;OPTION VALUE="20"&gt;20<br /> &lt;OPTION VALUE="21"&gt;21<br /> &lt;OPTION VALUE="22"&gt;22<br /> &lt;OPTION VALUE="23"&gt;23<br /> &lt;OPTION VALUE="24"&gt;24<br /> &lt;OPTION VALUE="25"&gt;25<br /> &lt;OPTION VALUE="26"&gt;26<br /> &lt;OPTION VALUE="27"&gt;27<br /> &lt;OPTION VALUE="28"&gt;28<br /> &lt;OPTION VALUE="29"&gt;29<br /> &lt;OPTION VALUE="30"&gt;30<br /> &lt;OPTION VALUE="31"&gt;31<br />&lt;/SELECT&gt;<br /><br /><br /><br /><br />&lt;SELECT name="month_end"&gt;<br /> &lt;OPTION VALUE="01"&gt;January<br /> &lt;OPTION VALUE="02"&gt; February<br /> &lt;OPTION VALUE="03"&gt;March<br /> &lt;OPTION VALUE="04"&gt;April<br /> &lt;OPTION VALUE="05"&gt; May<br /> &lt;OPTION VALUE="06"&gt;June<br /> &lt;OPTION VALUE="07"&gt;July<br /> &lt;OPTION VALUE="08"&gt; August<br /> &lt;OPTION VALUE="09 "&gt;September<br /> &lt;OPTION VALUE="10"&gt;October<br /> &lt;OPTION VALUE="11"&gt; November<br /> &lt;OPTION VALUE="12"&gt;December<br />&lt;/SELECT&gt;<br /><br /><br />&lt;SELECT name="year_end"&gt;<br /> &lt;OPTION VALUE="2008"&gt;2008<br /> &lt;OPTION VALUE="2009"&gt;2009<br /> &lt;OPTION VALUE="2010"&gt;2010<br />&lt;/SELECT&gt;<br /><br /><br />&lt;INPUT TYPE="submit" VALUE="OK"&gt;<br />&lt;/FORM&gt;<br /><br /><br /><br /><br />&lt;FORM method="POST" action="index_eth0.php"&gt;<br />&lt;INPUT TYPE="submit" VALUE="internal interface [eth0]"&gt;<br />&lt;/FORM&gt;<br />&lt;FORM method="POST" action="index_eth1.php"&gt;<br />&lt;INPUT TYPE="submit" VALUE="external interface [eth1]"&gt;<br />&lt;/FORM&gt;<br />&lt;/BODY&gt;<br />&lt;/HTML&gt;</div>
<p> </p>
<p><br /> <br /></p>
<h3><span style="color: blue; font-size: small;"><strong>Настраиваем httpd </strong></span><strong> </strong></h3>
<p><span style="color: green;">Создаем фаил traf_inza.conf в каталоге /etc/httpd/conf.d/ или где то у вас установлен apache</span></p>
<div class="codeheader">/etc/httpd/conf.d/traf_inza.conf</div>
<div class="code">Alias /traf_inza /var/www/html/traf_inza/index<br />&lt;Directory /var/www/html/traf_inza/index&gt;<br /> DirectoryIndex index.php<br />&lt;/Directory&gt;</div>
<p> </p>
<p>Ну и все набираем в браузере <span style="color: red;">http://192.168.50.3/traf_inza/</span> и наслаждаемся:)</p>

</body>

</html>